function slideInAndOutContent(e,a){const t=document.querySelector(e),i=document.querySelector(".ast-order-review-toggle-text");t&&t.addEventListener("click",function(e){const t=document.querySelector(a);var o=t.querySelector("*");if(t)if(e.currentTarget.classList.contains("active"))e.currentTarget.classList.remove("active"),t.style.maxHeight=0,setTimeout(()=>{t.style.display="none"},300),i&&(i.textContent=astraAddon.order_review_toggle_texts.toggle_show_text);else if(o&&(e.currentTarget.classList.add("active"),t.style.display="block",t.style.maxHeight=o.clientHeight+"px",i)){i.textContent=astraAddon.order_review_toggle_texts.toggle_hide_text;const n=document.querySelector("#ast-order-review-content"),s=document.querySelector("#order_review");["change",'select.shipping_method, input[name^="shipping_method"]'].forEach(e=>n.addEventListener(e,function(){s.querySelectorAll('input[name^="shipping_method"][type="radio"]:checked').forEach(e=>{e.removeAttribute("checked")}),document.querySelector("body").dispatchEvent(new CustomEvent("update_checkout",{detail:{update_shipping_method:!0}}))}))}})}let xhrCountEmail=0,delayTimerEmail;function validateInlineEmail(){const n=document.querySelector("#billing_email");if(n){const s=n.value;if(void 0===s||astraAddon.is_logged_in)return;const a=document.querySelector(".ast-create-account-section"),i=document.querySelector(".woocommerce-billing-fields__customer-login-label"),c=document.querySelector(".ast-email-validation-block"),r=document.querySelector("#ast-customer-login-url");if(""!==s){c&&c.remove(),clearTimeout(delayTimerEmail);const l=++xhrCountEmail;delayTimerEmail=setTimeout(async function(){let o=new XMLHttpRequest;o.open("POST",astra.ajax_url,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send("action=astra_woo_check_user_exist&user_name_email="+s+"&security="+astraAddon.check_user_exist_nonce),o.onload=function(){if(o.readyState==XMLHttpRequest.DONE&&(200<=o.status||400<=o.status)){document.cookie="ast_modern_checkout_useremail="+s;var e=JSON.parse(o.responseText);if(l===xhrCountEmail)if(c&&c.remove(),e.data.success&&r&&r.classList.contains("active"))n.insertAdjacentHTML("afterend",'<span class="ast-email-validation-block success">'+astraAddon.user_validation_msgs.success_msg+"</span>");else if(e.data.success)e.data.is_login_allowed&&(n.insertAdjacentHTML("afterend",'<span class="ast-email-validation-block success">'+astraAddon.user_validation_msgs.success_msg+"</span>"),r&&!r.classList.contains("active")&&r.click()),a&&(a.style.display="none"),i&&(i.style.display="block");else{if(r&&r.classList.contains("active")&&r.click(),a){const t=a.querySelector(".create-account label.checkbox");t&&(t.style.display="block"),a.style.display="block"}i&&""==s&&(i.style.display="none")}}}},300)}else r&&r.classList.contains("active")&&r.click(),c&&(c.style.display="none"),i&&(i.style.display="block"),a&&(a.style.display="none")}return!1}function supportNativeEmailFunctionality(){var e=document.querySelector("#billing_email");if(e){e=e.value;if(void 0===e||astraAddon.is_logged_in)return;const t=document.querySelector(".ast-create-account-section");t&&(t.style.display=""!==e?"block":"none")}return!1}function woocommerceUserLogin(){const e=document.querySelector(".ast-customer-login-section__login-button");e&&e.addEventListener("click",function(){var e=document.querySelector("#billing_email"),t=document.querySelector("#billing_password");if(e||!t){let o=new XMLHttpRequest;o.open("POST",astra.ajax_url,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send("action=astra_woocommerce_login_user&user_name_email="+e.value+"&password="+t.value+"&security="+astraAddon.woocommerce_login_nonce),o.onload=function(){if(o.readyState==XMLHttpRequest.DONE&&(200<=o.status||400<=o.status)){var e=JSON.parse(o.responseText);if(e.data.success)location.reload();else{const t=document.querySelector(".ast-customer-info__notice");t&&(t.classList.add("active"),t.innerHTML=e.data.error)}}}}})}document.addEventListener("DOMContentLoaded",function(e){const t=document.querySelector("body");if(!astraAddon.cartflows_version&&t&&t.classList.contains("woocommerce-checkout")){var o=astraAddon.is_complete_package;const n=document.querySelector("#billing_email");n&&(o?(n.addEventListener("input",validateInlineEmail),validateInlineEmail()):(n.addEventListener("input",supportNativeEmailFunctionality),supportNativeEmailFunctionality())),t&&!t.classList.contains("ast-woo-two-step-modern-checkout")&&slideInAndOutContent("#ast-order-review-toggle","#ast-order-review-content"),o&&(slideInAndOutContent("#ast-customer-login-url","#ast-customer-login-section"),woocommerceUserLogin())}});